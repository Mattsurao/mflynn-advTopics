<!DOCTYPE html>
<html>
<head>

  <title>Matthew Flynn's Music</title>
  <link rel=stylesheet href="{{ url_for('static', filename='style.css') }}" type=text/css>

</head>
<body>

  <!-- the Navigation Bar -->
  <div id="nav_bar">
    <ul>
      <li><a href="home.html">Home</a></li>
      <li><a href="music.html" class=active>Music</a></li>
      <li><a href="bio.html">Bio</a></li>
      <li><a href="gallery.html">Gallery</a></li>
    </ul>
    <img src="{{ url_for('static', filename='vgm_note.png')}}" id="note" oncontextmenu="return false">
  </div>

  <h1>Music</h1>

  <!-- loop through all the projects and display them -->
  {% for project in projects %}

    <div class=project>
      <div class=proj_head>
        <h1>{{ project.genre }}: {{ project.name }}</h1>
        <p>{{ project.desc }}</p>
        <button class=details>--- More Details ---</button>
        <div class=details_panel>
          <p>Worked as {{ project.title }}, {{ project.date }}.
            {% if project.commisioner != None %}
              commisioned by {{ project.commisioner }}
            {% endif %}
          </p>
        </div>
      </div>

      {% set tracks = all_tracks[project.id - 1] %}

      <!-- the project is displayed differently if there's only 1 track -->
      {% if tracks|length == 1 %}
        <div class=track>
          <!-- display information about the track -->
          <div class=info>
            <p>Runtime: {{ tracks[0].runtime }}</p>
            <p>Copyright: {{ tracks[0].copyright }}</p>
          </div>
          <!-- display any files: MP3s, PDFs, etc. -->
          {% if tracks[0].playback %}
            <div class=audio>
              <p>{{ project.audio_text }}</p>
              <audio controls controlsList='nodownload' oncontextmenu='return false'>
                <source src="{{ url_for('static', filename = tracks[0].path + '.mp3') }}">
                Your browser does not support audio playback
              </audio>
            </div>
          {% endif %}
          {% if tracks[0].pdf %}
            <a href="{{ url_for('static', filename = tracks[0].path + '.pdf') }}" download>
              Download the sheet music
            </a>
          {% endif %}
        </div>

      <!-- when there's more than 1 track in the project -->
      {% else %}
        {% for track in tracks %}
          <div class=track>
            <h2>Track {{ track.number }}: {{ track.name }}</h2>
            <!-- display information about the track -->
            <div class=info>
              <p>Runtime: {{ track.runtime }}</p>
              <p>Copyright: {{ track.copyright }}</p>
            </div>
            <!-- display any files: MP3s, PDFs, etc. -->
            {% if track.playback %}
              <div class=audio>
                <p>{{ project.audio_text }}</p>
                <audio controls controlsList='nodownload' oncontextmenu='return false'>
                  <source src="{{ url_for('static', filename = track.path + '.mp3') }}">
                  Your browser does not support audio playback
                </audio>
              </div>
            {% endif %}
            {% if track.pdf %}
              <a href="{{ url_for('static', filename = track.path + '.pdf') }}" download>
                Download the sheet music
              </a>
            {% endif %}
          </div>
        {% endfor %}
      {% endif %}

    </div>

  {% endfor %}

  <script>
    // set up the 'More Details' buttons (in the project headers)
    var acc_buttons = document.getElementsByClassName('details');
    var i;
    for (i = 0;i < acc_buttons.length;i++){
      acc_buttons[i].addEventListener('click', function(){
        // change the text of the button
        if (this.innerHTML === "--- More Details ---"){
          this.innerHTML = "--- Less Details ---";
        }else{
          this.innerHTML = "--- More Details ---";
        }
        // chance the display state of the details panel
        var panel = this.nextElementSibling;
        if (panel.style.display === 'block'){
          panel.style.display = 'none';
        }else{
          panel.style.display = 'block';
        }
      });
    }
  </script>

</body>
</html>
